<!DOCTYPE html>
<html lang="ja" id="html-tag">
<head>
  <meta charset="UTF-8">
  <title>バス運行状況</title>
  <style>
    body {
      margin: 0;
      font-family: "Noto Sans JP", sans-serif;
      overflow: hidden;
      -webkit-user-select: none;
      user-select: none;
    }
    
    html[lang="ko"] body { font-family: "Noto Sans KR", sans-serif; }
    html[lang="zh-CN"] body { font-family: "Noto Sans SC", sans-serif; }
    html[lang="zh-TW"] body { font-family: "Noto Sans TC", sans-serif; }

    #welcome-screen {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #222;
      color: white;
    }
    #welcome-screen h1 {
      font-size: 2.5em;
      display: flex;
      align-items: center;
      border-bottom: 2px solid white;
      padding-bottom: 20px;
      margin-bottom: 40px;
    }
    .welcome-lang-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      width: 100%;
      max-width: 600px;
      padding: 0 20px;
    }
    .welcome-lang-buttons button {
      font-size: 1.5em;
      padding: 20px;
      background-color: #444;
      color: white;
      border: 1px solid #666;
      cursor: pointer;
      border-radius: 8px;
    }
    .welcome-lang-buttons .full-width {
      grid-column: 1 / -1;
    }

    .main {
      display: flex;
      width: 100%;
      height: 100vh;
    }

    .bus-area {
      background-color: #222;
      color: white;
      padding: 2.5vw;
      flex: 1;
      display: flex;
      flex-direction: column;
      transition: transform 0.4s ease-in-out, filter 0.4s ease-in-out;
      transform-origin: center;
    }
    .bus-area.settings-active {
      transform: scale(0.85);
      border-radius: 20px;
      filter: brightness(0.7);
      box-shadow: -5px 0 25px rgba(0,0,0,0.5);
    }

    .settings-area {
      background-color: #ddd;
      color: black;
      padding: 20px;
      flex: 0 0 320px;
      display: none;
      flex-direction: column;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 1.5vh;
    }
    .left {
      display: flex;
      align-items: center;
      white-space: nowrap;
    }
    .bus-icon { font-size: 3.8vw; }
    .title { font-size: 4vw; margin-left: 2vw; }
    .gear { font-size: 3.5vw; cursor: pointer; }
    #current-time { font-size: 3.5vw; }
    .route { font-size: 4vw; margin: 2vh 0; border-top: 2px solid white; padding-top: 2vh; }
    .time-table { font-size: 3.5vw; line-height: 1.7; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-around; }
    .time-row { display: flex; justify-content: space-between; max-width: 100%; align-items: baseline; white-space: nowrap; }
    .time-large { font-size: 5.5vw; font-weight: bold; }

    .hidden { display: none; }
    .header-row { display: flex; align-items: center; font-size: 24px; cursor: pointer; }
    .header-row .back-arrow { font-size: 30px; font-weight: bold; }
    .header-row span { margin-left: 10px; }
    .section { margin-top: 30px; }

    .setting-buttons, .language-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }
    .setting-buttons button, .language-buttons button {
      font-size: 18px;
      padding: 15px;
      background-color: #555;
      color: white;
      border: none;
      cursor: pointer;
      text-align: center;
      border-radius: 5px;
    }
    .setting-buttons button {
      font-size: 20px;
      padding: 15px 10px;
      background-color: #444;
    }
    .language-buttons button.active {
      background-color: #4CAF50;
    }

    .color-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 18px; }
    .color-row input[type="color"] { width: 50px; height: 30px; border: none; cursor: pointer; }
    .route-selection-buttons { display: flex; flex-direction: column; gap: 15px; margin-top: 10px; }
    .route-selection-buttons button { font-size: 18px; padding: 15px; background-color: #555; color: white; border: none; cursor: pointer; text-align: center; border-radius: 5px; }
    .route-selection-buttons button.active { background-color: #4CAF50; }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Noto+Sans+KR:wght@400;700&family=Noto+Sans+SC:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

  <div id="welcome-screen">
      <h1><span class="bus-icon">🚍</span> 運行情報表示板</h1>
      <div class="welcome-lang-buttons">
          <button onclick="startApp('ja')">日本語</button>
          <button onclick="startApp('en')">English</button>
          <button onclick="startApp('zh-CN')">中文(简体)</button>
          <button onclick="startApp('zh-TW')">中文(簡體)</button>
          <button class="full-width" onclick="startApp('ko')">한국어</button>
      </div>
  </div>

  <div class="main" id="main-container" style="display: none;">
    <div class="bus-area" id="bus-status">
      <div class="top-bar">
        <div class="left">
          <span class="bus-icon">🚍</span>
          <span class="title" data-translate="title">バス運行状況</span>
        </div>
        <div>
          <span id="current-time" style="margin-right: 10px;">16:40</span>
          <span class="gear" onclick="openSettings()">⚙️</span>
        </div>
      </div>
      <div class="route" id="route-name">向原 ➝ 南柏駅東口</div>
      <div class="time-table" id="time-table"></div>
    </div>

    <div class="settings-area" id="settings-panel">
      <div id="settings-main" class="settings-subpanel">
        <div class="header-row" onclick="closeSettings()">
           <span class="back-arrow">&lt;</span> <span data-translate="settings_back_to_main">メイン画面</span>
        </div>
        <div class="section">
          <h3 data-translate="settings_main_title">設定</h3>
          <div class="setting-buttons">
            <button data-translate="btn_display" onclick="showPanel('display-settings')">表示</button>
            <button data-translate="btn_stop" onclick="showPanel('bus-stop-settings')">バス停変更</button>
            <button data-translate="btn_lang" onclick="showPanel('language-settings')">言語</button>
            <button data-translate="btn_terms" onclick="alert('利用規約がクリックされました')">利用規約</button>
          </div>
        </div>
      </div>

      <div id="display-settings" class="settings-subpanel hidden">
        <div class="header-row" onclick="showPanel('settings-main')">
          <span class="back-arrow">&lt;</span> <span data-translate="settings_back">設定</span>
        </div>
        <div class="section">
          <h3 data-translate="display_title">表示</h3>
          <div class="color-row"><span data-translate="color_base">ベース</span><input type="color" onchange="changeColor('base', this.value)"></div>
          <div class="color-row"><span data-translate="color_title">タイトル</span><input type="color" onchange="changeColor('title', this.value)"></div>
          <div class="color-row"><span data-translate="color_time">現在時刻</span><input type="color" onchange="changeColor('time', this.value)"></div>
          <div class="color-row"><span data-translate="color_route">路線名</span><input type="color" onchange="changeColor('route', this.value)"></div>
          <div class="color-row"><span data-translate="color_scheduled">定刻時間</span><input type="color" onchange="changeColor('scheduled', this.value)"></div>
          <div class="color-row"><span data-translate="color_predicted">予測時間</span><input type="color" onchange="changeColor('predicted', this.value)"></div>
        </div>
      </div>

      <div id="language-settings" class="settings-subpanel hidden">
        <div class="header-row" onclick="showPanel('settings-main')">
          <span class="back-arrow">&lt;</span> <span data-translate="settings_back">設定</span>
        </div>
        <div class="section">
          <h3 data-translate="lang_title">言語</h3>
          <div class="language-buttons">
            <button class="active" onclick="selectLanguage(this)" data-lang="ja">日本語</button>
            <button onclick="selectLanguage(this)" data-lang="en">English</button>
            <button onclick="selectLanguage(this)" data-lang="zh-CN">中文(简体)</button>
            <button onclick="selectLanguage(this)" data-lang="zh-TW">中文(簡體)</button>
            <button onclick="selectLanguage(this)" data-lang="ko">한국어</button>
          </div>
        </div>
      </div>
      
      <div id="bus-stop-settings" class="settings-subpanel hidden">
        <div class="header-row" onclick="showPanel('settings-main')">
          <span class="back-arrow">&lt;</span> <span data-translate="settings_back">設定</span>
        </div>
        <div class="section">
          <h3 data-translate="bus_stop_title">バス停変更</h3>
          <div class="route-selection-buttons">
            <button id="route-btn-mukaihara" class="active" onclick="selectRoute(this, 'mukaihara')"></button>
            <button id="route-btn-reitaku" onclick="selectRoute(this, 'reitaku')"></button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentRouteId = 'mukaihara';
    const routeData = {
        mukaihara: { ja: "向原 ➝ 南柏駅東口", en: "Mukaihara → Minami-Kashiwa Sta. EAST", 'zh-CN': "向原 → 南柏站东口", 'zh-TW': "向原 → 南柏站東口", ko: "무카이하라 → 미나미카시와역 동쪽 출구" },
        reitaku: { ja: "麗澤大学前 ➝ 南柏駅東口", en: "Reitaku Daigaku-mae → Minami-Kashiwa Sta. EAST", 'zh-CN': "丽泽大学前 → 南柏站东口", 'zh-TW': "麗澤大學前 → 南柏站東口", ko: "레이타쿠대학 앞 → 미나미카시와역 동쪽 출구" }
    };
    const translations = {
        ja: { title: "バス運行状況", scheduled: "定刻", predicted: "予測", departure: "発", settings_back_to_main: "メイン画面", settings_main_title: "設定", btn_display: "表示", btn_stop: "バス停変更", btn_lang: "言語", btn_terms: "利用規約", settings_back: "設定", display_title: "表示", lang_title: "言語", bus_stop_title: "バス停変更", color_base: "ベース", color_title: "タイトル", color_time: "現在時刻", color_route: "路線名", color_scheduled: "定刻時間", color_predicted: "予測時間" },
        en: { title: "Bus operation status", scheduled: "Schedule", predicted: "Predicted", departure: "", settings_back_to_main: "Main screen", settings_main_title: "Setting", btn_display: "Display", btn_stop: "Bus stop change", btn_lang: "Language", btn_terms: "Terms of service", settings_back: "Setting", display_title: "Display", lang_title: "Language", bus_stop_title: "Bus stop change", color_base: "Base", color_title: "Title", color_time: "Current time", color_route: "Route name", color_scheduled: "Scheduled time", color_predicted: "Predicted time" },
        'zh-CN': { title: "公交运营状况", scheduled: "预定", predicted: "预计", departure: "出发", settings_back_to_main: "主屏幕", settings_main_title: "设置", btn_display: "显示", btn_stop: "公交车站变更", btn_lang: "语言", btn_terms: "服务条款", settings_back: "设置", display_title: "显示", lang_title: "语言", bus_stop_title: "公交车站变更", color_base: "基础", color_title: "标题", color_time: "当前时间", color_route: "路线名称", color_scheduled: "预定时间", color_predicted: "预计时间" },
        'zh-TW': { title: "公車營運狀況", scheduled: "預定", predicted: "預測", departure: "出發", settings_back_to_main: "主螢幕", settings_main_title: "設定", btn_display: "顯示", btn_stop: "公車站變更", btn_lang: "語言", btn_terms: "服務條款", settings_back: "設定", display_title: "顯示", lang_title: "語言", bus_stop_title: "公車站變更", color_base: "基礎", color_title: "標題", color_time: "當前時間", color_route: "路線名稱", color_scheduled: "預定時間", color_predicted: "預測時間" },
        ko: { title: "버스 운행 현황", scheduled: "정시", predicted: "예측", departure: "출발", settings_back_to_main: "메인 화면", settings_main_title: "설정", btn_display: "표시", btn_stop: "버스 정류장 변경", btn_lang: "언어", btn_terms: "이용약관", settings_back: "설정", display_title: "표시", lang_title: "언어", bus_stop_title: "버스 정류장 변경", color_base: "베이스", color_title: "제목", color_time: "현재 시간", color_route: "노선명", color_scheduled: "정시 시간", color_predicted: "예측 시간" }
    };
    const times = [ { scheduled: "16:43", predicted: "16:46" }, { scheduled: "16:51", predicted: "16:55" }, { scheduled: "16:57", predicted: "16:59" } ];

    const UIElements = {
        busStatus: document.getElementById('bus-status'),
        settingsPanel: document.getElementById('settings-panel'),
        settingsSubpanels: document.querySelectorAll('.settings-subpanel'),
        routeName: document.getElementById('route-name'),
        titleText: document.querySelector('[data-translate="title"]'),
        timeTable: document.getElementById('time-table')
    };

    function createTimeTable(lang) {
        const t = translations[lang];
        UIElements.timeTable.innerHTML = times.map(entry => `
            <div class="time-row">
                <div><span class="label-base">${t.scheduled}</span> <span class="time-large">${entry.scheduled}</span></div>
                <div><span class="label-base">${t.predicted}</span> <span class="time-large">${entry.predicted}</span> <span class="label-base">${t.departure}</span></div>
            </div>
        `).join('');
    }

    function startApp(lang) {
        document.getElementById('welcome-screen').style.display = 'none';
        document.getElementById('main-container').style.display = 'flex';
        selectLanguage(document.querySelector(`.language-buttons button[data-lang='${lang}']`));
    }

    function openSettings() {
      UIElements.busStatus.classList.add('settings-active');
      UIElements.settingsPanel.style.display = "flex";
      showPanel('settings-main');
      updateText(document.documentElement.lang || 'ja');
    }

    function closeSettings() {
      UIElements.busStatus.classList.remove('settings-active');
      UIElements.settingsPanel.style.display = "none";
      updateText(document.documentElement.lang || 'ja');
    }

    function showPanel(panelId) {
        UIElements.settingsSubpanels.forEach(panel => {
            panel.classList.toggle('hidden', panel.id !== panelId);
        });
    }

    function changeColor(type, color) {
        const root = document.documentElement;
        switch (type) {
            case "base": root.style.setProperty('--label-color', color); break;
            case "title": UIElements.titleText.style.color = color; break;
            case "time": document.getElementById('current-time').style.color = color; break;
            case "route": UIElements.routeName.style.color = color; break;
            case "scheduled": root.style.setProperty('--scheduled-time-color', color); break;
            case "predicted": root.style.setProperty('--predicted-time-color', color); break;
        }
    }
    
    function selectLanguage(selectedButton) {
        document.querySelectorAll(".language-buttons button").forEach(button => button.classList.remove("active"));
        selectedButton.classList.add("active");
        updateText(selectedButton.dataset.lang);
    }
    
    function selectRoute(selectedButton, routeId) {
        document.querySelectorAll(".route-selection-buttons button").forEach(button => button.classList.remove("active"));
        selectedButton.classList.add("active");
        currentRouteId = routeId;
        updateText(document.documentElement.lang || 'ja');
    }

    function updateText(lang) {
        document.documentElement.lang = lang;
        const t = translations[lang];
        
        document.querySelectorAll('[data-translate]').forEach(el => {
            el.innerText = t[el.dataset.translate];
        });

        UIElements.routeName.innerText = routeData[currentRouteId][lang];
        document.getElementById('route-btn-mukaihara').innerText = routeData.mukaihara[lang];
        document.getElementById('route-btn-reitaku').innerText = routeData.reitaku[lang];
        
        createTimeTable(lang);

        const isSettingsActive = UIElements.busStatus.classList.contains('settings-active');
        UIElements.titleText.style.fontSize = (isSettingsActive && lang === 'en') ? '3.5vw' : '';
        UIElements.routeName.style.fontSize = (isSettingsActive && currentRouteId === 'reitaku' && lang === 'en') ? '3.0vw' :
                                             (isSettingsActive && currentRouteId === 'reitaku' && lang === 'ko') ? '3.4vw' : '';
    }

    createTimeTable('ja');
  </script>
</body>
</html>